<!DOCTYPE html>
<html>
<head>
    <title>API Key Manager</title>
    <style>
        /* Copy CSS dari index.html sebelumnya */
        body {
            font-family: Arial, sans-serif;
            background-color: #202224;
            margin: 0;
            padding: 20px;
            color: #c5ccd2;
        }
        /* ... (sama seperti sebelumnya) ... */
    </style>
</head>
<body>
    <h1>Setting API Keys</h1>
    
    <form id="addForm">
        <div class="form-group">
            <label for="api-key">API Key:</label>
            <input type="text" id="api-key" name="api_key" required>
        </div>
        <div class="form-group">
            <label for="expiry-time">Expired Time:</label>
            <input type="datetime-local" id="expiry-time" name="expired_time" required>
        </div>
        <button type="submit">Add Key</button>
    </form>
    
    <h2>Existing API Keys</h2>
    <div id="keysList"></div>
    
    <h2>API Key Activity Log</h2>
    <p><a href="/log">View Activity Log</a></p>
    
    <script>
        // JavaScript untuk handle form dan fetch data
        document.addEventListener('DOMContentLoaded', loadKeys);
        
        document.getElementById('addForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                api_key: formData.get('api_key'),
                expired_time: formData.get('expired_time')
            };
            
            const response = await fetch('/api/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            alert(result.message);
            if (result.status === 'success') {
                e.target.reset();
                loadKeys();
            }
        });
        
        async function loadKeys() {
            const response = await fetch('/api/keys');
            const keys = await response.json();
            
            const keysList = document.getElementById('keysList');
            keysList.innerHTML = '';
            
            const currentTime = new Date();
            
            for (const [key, value] of Object.entries(keys)) {
                if (!value.deleted) {
                    const expiredTime = new Date(value.expired);
                    const isExpired = currentTime > expiredTime;
                    
                    const li = document.createElement('div');
                    li.className = 'key-item';
                    li.style.background = '#ffffff';
                    li.style.padding = '15px';
                    li.style.margin = '10px 0';
                    li.style.borderRadius = '8px';
                    li.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
                    
                    li.innerHTML = `
                        <strong>Key:</strong> ${key} <br>
                        <strong>Expired:</strong> ${value.expired} <br>
                        <strong>Created:</strong> ${value.created_at} <br>
                        ${isExpired ? `
                            <button onclick="markDeleted('${key}')" style="background:#dc3545;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;">
                                Delete
                            </button>
                        ` : ''}
                    `;
                    
                    keysList.appendChild(li);
                }
            }
        }
        
        async function markDeleted(apiKey) {
            if (confirm('Mark this API key as deleted?')) {
                const response = await fetch(`/api/deleted/${apiKey}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                alert(result.message);
                loadKeys();
            }
        }
    </script>
</body>
</html>